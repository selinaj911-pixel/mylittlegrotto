<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>çµå¢ƒÂ·è¡¥å¤©è‡ªå®ˆå½•</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="è¡¥å¤©è‡ªå®ˆå½•">
    <meta name="theme-color" content="#f4f1de">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --ink: #2c3e50;
            --paper: #f4f1de;
            --lamp-glow: #e6b422;
            --crimson: #a0522d;
            --teal: #4a6572;
            --border: rgba(44, 62, 80, 0.1);
        }

        body {
            background-color: var(--paper);
            background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png');
            color: var(--ink);
            font-family: "STSong", "KaiTi", serif;
            margin: 0; padding: 15px;
            display: flex; justify-content: center;
            /* é€‚é…æ‰‹æœºç«¯å…¨å±ç‚¹å‡» */
            -webkit-tap-highlight-color: transparent;
        }

        .container { width: 100%; max-width: 1200px; }

        header { text-align: center; margin-bottom: 20px; border-bottom: 1px solid var(--ink); padding-bottom: 10px; }
        .motto { font-size: 0.9em; color: var(--crimson); letter-spacing: 2px; }

        .top-info { display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 20px; }
        @media (min-width: 768px) { .top-info { grid-template-columns: 350px 1fr; } }
        
        .card { 
            background: rgba(255, 255, 255, 0.5); 
            backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            border-radius: 12px; padding: 15px;
        }

        .realm-name { font-size: 1.6em; font-weight: bold; color: var(--lamp-glow); }

        /* æ¸…å•åŒºåŸŸï¼šæ‰‹æœºç«¯å•åˆ—ï¼Œç”µè„‘ç«¯ä¸‰åˆ— */
        .list-container { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 1024px) { .list-container { grid-template-columns: repeat(3, 1fr); } }

        .list-section { display: flex; flex-direction: column; gap: 12px; }
        
        .todo-header { 
            font-weight: bold; border-bottom: 2px solid var(--ink); 
            padding-bottom: 5px; display: flex; justify-content: space-between; align-items: center;
            font-size: 1.1em;
        }

        .study-box { background: rgba(255, 255, 255, 0.7); border-radius: 8px; padding: 12px; border: 1px solid var(--border); margin-bottom: 8px; }
        .study-box h4 { margin: 0 0 8px 0; font-size: 0.85em; color: var(--teal); border-bottom: 1px solid var(--border); }

        .task-list { list-style: none; padding: 0; margin: 0; }
        .task-item { 
            display: flex; align-items: center; padding: 10px 0; 
            border-bottom: 1px dashed rgba(0,0,0,0.05); font-size: 0.9em; 
        }
        .task-item input[type="checkbox"] { margin-right: 12px; width: 18px; height: 18px; cursor: pointer; }

        .input-group { display: flex; gap: 5px; margin-top: 8px; }
        .input-group input { 
            flex: 1; border: none; border-bottom: 1px solid #ccc; 
            background: transparent; padding: 8px; font-size: 0.9em; outline: none;
        }
        .btn { cursor: pointer; border: none; padding: 6px 12px; border-radius: 4px; font-size: 0.8em; }
        .btn-add { background: var(--ink); color: white; }
        
        .backup-zone { margin-top: 30px; text-align: center; border-top: 1px solid #ccc; padding-top: 15px; padding-bottom: 30px; }

        /* å›¾è¡¨é«˜åº¦é€‚é… */
        canvas { max-height: 230px !important; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>çµå¢ƒÂ·è¡¥å¤©è‡ªå®ˆå½•</h1>
        <div class="motto">â€œèº«åœ¨æ³¥æ½­ï¼Œå¿ƒå¦‚ç‰ç’ƒã€‚â€</div>
    </header>

    <div class="top-info">
        <div class="card" style="text-align:center">
            <div id="realm-display" class="realm-name">è½½å…¥ä¸­...</div>
            <div id="countdown-display" style="font-size:0.8em; color:var(--crimson); margin:8px 0;">è®¡ç®—ä¸­...</div>
            <div style="text-align:left; font-size:0.8em; margin-top:10px;">
                å¹³å‡ç‰ç’ƒåº¦: <span id="avg-val">3.0</span>
                <div style="background:rgba(0,0,0,0.05); height:6px; border-radius:3px; margin-top:5px;">
                    <div id="exp-bar" style="background:var(--lamp-glow); height:100%; width:30%; transition:0.8s;"></div>
                </div>
            </div>
            <button class="btn" style="width:100%; margin-top:12px; border:1px solid var(--crimson); color:var(--crimson); background:transparent; font-weight:bold;" onclick="triggerAdventure()">âœ¨ é€’å‡ºæ³¨å®šçš„ä¸€å‰‘ (+1.0)</button>
        </div>
        <div class="card">
            <canvas id="radarChart"></canvas>
        </div>
    </div>

    <div class="list-container">
        <div class="list-section">
            <div class="todo-header">ğŸ“š æ‚Ÿé“Â·ä½¿å‘½ <span id="lv-1">3.0</span></div>
            <div class="study-box">
                <h4>ã€é˜µåˆ—å› æœã€‘ç¼–ç¨‹é¡¹ç›®</h4>
                <ul id="list-coding" class="task-list"></ul>
                <div class="input-group"><input type="text" id="in-coding" placeholder="è¾“å…¥..." onkeydown="if(event.keyCode==13)addTask('coding')"><button class="btn btn-add" onclick="addTask('coding')">æ·»åŠ </button></div>
            </div>
            <div class="study-box">
                <h4>ã€é—®å¿ƒè¯•ç‚¼ã€‘å¿ƒç†å®éªŒ</h4>
                <ul id="list-psy" class="task-list"></ul>
                <div class="input-group"><input type="text" id="in-psy" placeholder="è¾“å…¥..." onkeydown="if(event.keyCode==13)addTask('psy')"><button class="btn btn-add" onclick="addTask('psy')">æ·»åŠ </button></div>
            </div>
            <div class="study-box">
                <h4>ã€åˆçºµç§˜å·ã€‘åˆä½œä»»åŠ¡</h4>
                <ul id="list-collab" class="task-list"></ul>
                <div class="input-group"><input type="text" id="in-collab" placeholder="è¾“å…¥..." onkeydown="if(event.keyCode==13)addTask('collab')"><button class="btn btn-add" onclick="addTask('collab')">æ·»åŠ </button></div>
            </div>
            <div class="study-box" style="border:1px solid var(--crimson)">
                <h4>ã€æœ¬å‘½ç»ä¼ ã€‘Thesis & é—¨æˆ·</h4>
                <ul id="list-core" class="task-list"></ul>
                <div class="input-group"><input type="text" id="in-core" placeholder="è¾“å…¥æ ¸å¿ƒä»»åŠ¡..." onkeydown="if(event.keyCode==13)addTask('core')"><button class="btn btn-add" onclick="addTask('core')">æ·»åŠ </button></div>
            </div>
        </div>

        <div class="list-section">
            <div class="todo-header">âš”ï¸ é‡‘èº«Â·è‡ªæŒ <span id="lv-2">3.0</span></div>
            <div class="card">
                <ul id="list-sport" class="task-list"></ul>
                <div class="input-group"><input type="text" id="in-sport" placeholder="æ·»åŠ è¿åŠ¨..." onkeydown="if(event.keyCode==13)addTask('sport')"><button class="btn btn-add" onclick="addTask('sport')">æ·»åŠ </button></div>
            </div>
        </div>

        <div class="list-section">
            <div class="todo-header">ğŸ¨ ç¢ç‰Â·é€¸è‡´ <span id="lv-3">3.0</span></div>
            <div class="card">
                <ul id="list-craft" class="task-list"></ul>
                <div class="input-group"><input type="text" id="in-craft" placeholder="æ·»åŠ æ‰‹å·¥..." onkeydown="if(event.keyCode==13)addTask('craft')"><button class="btn btn-add" onclick="addTask('craft')">æ·»åŠ </button></div>
            </div>
            <div class="todo-header" style="margin-top:10px;">ğŸ“Œ çº¢å°˜å¿…ä¿® (Daily)</div>
            <div class="card">
                <ul id="list-daily" class="task-list"></ul>
                <div class="input-group"><input type="text" id="in-daily" placeholder="æ¯æ—¥å¿…ä¿®..." onkeydown="if(event.keyCode==13)addTask('daily')"><button class="btn btn-add" onclick="addTask('daily')">æ·»åŠ </button></div>
            </div>
        </div>
    </div>

    <div class="backup-zone">
        <button class="btn" onclick="exportData()">ğŸ“¦ å¤‡ä»½é“æœ</button>
        <button class="btn" onclick="importData()">ğŸ“¥ æ¢å¤ä¿®ä¸º</button>
    </div>
</div>

<script>
    // é€»è¾‘ä¿æŒä¸€è‡´ï¼Œä½¿ç”¨ä¹‹å‰çš„ v5_destiny å­˜å‚¨é”®ä»¥ä¿æŒæ•°æ®å»¶ç»­
    let stats = JSON.parse(localStorage.getItem('doc_final_app_v1')) || {
        study: 3.0, sport: 3.0, craft: 3.0, luck: 3.0, persistence: 3.0,
        tasks: { coding: [], psy: [], collab: [], core: [], sport: [], craft: [], daily: [] }
    };

    const realms = [
        { min: 0, name: "çº¢å°˜æ•£ä¿®" }, { min: 3, name: "å¦‚ä¸€åˆç°" },
        { min: 5, name: "å†…å¢ƒè¡¥å¤©" }, { min: 8, name: "ç‰ç’ƒé€šæ˜" }
    ];
    let myChart;

    function save() { localStorage.setItem('doc_final_app_v1', JSON.stringify(stats)); }

    function addTask(type) {
        const input = document.getElementById(`in-${type}`);
        if (!input.value) return;
        stats.tasks[type].push({ id: Date.now(), text: input.value });
        input.value = '';
        save(); render();
    }

    function completeTask(type, id) {
        setTimeout(() => {
            stats.tasks[type] = stats.tasks[type].filter(t => t.id !== id);
            const inc = 0.1;
            if(['coding','psy','collab','core'].includes(type)) stats.study = Math.min(10, stats.study + inc);
            else if(type === 'sport') stats.sport = Math.min(10, stats.sport + inc);
            else if(type === 'craft') stats.craft = Math.min(10, stats.craft + inc);
            stats.persistence = Math.min(10, stats.persistence + 0.05);
            save(); render();
        }, 300);
    }

    function triggerAdventure() {
        if(confirm("é€’å‡ºè¿™å…³é”®ä¸€å‰‘ï¼Ÿ")) {
            stats.study = Math.min(10, stats.study + 1.0);
            stats.luck = Math.min(10, stats.luck + 0.5);
            save(); render();
        }
    }

    function render() {
        const avg = (stats.study + stats.sport + stats.craft + stats.luck + stats.persistence) / 5;
        document.getElementById('avg-val').innerText = avg.toFixed(1);
        document.getElementById('exp-bar').style.width = (avg * 10) + '%';
        let realm = realms[0].name;
        for (let r of realms) { if (avg >= r.min) realm = r.name; }
        document.getElementById('realm-display').innerText = realm;

        Object.keys(stats.tasks).forEach(type => {
            const list = document.getElementById(`list-${type}`);
            if(list) {
                list.innerHTML = stats.tasks[type].map(t => `
                    <li class="task-item">
                        <input type="checkbox" onclick="completeTask('${type}', ${t.id})">
                        <span>${t.text}</span>
                    </li>
                `).join('');
            }
        });

        document.getElementById('lv-1').innerText = stats.study.toFixed(1);
        document.getElementById('lv-2').innerText = stats.sport.toFixed(1);
        document.getElementById('lv-3').innerText = stats.craft.toFixed(1);
        if(myChart) updateChart();
    }

    function updateCountdown() {
        const days = Math.floor((new Date('2027-10-01') - new Date()) / 86400000);
        document.getElementById('countdown-display').innerText = `è·ç¦»2027ä»™é—¨å¤§æ¯”ï¼šä½™ ${days} æ—¥`;
    }

    function initChart() {
        myChart = new Chart(document.getElementById('radarChart'), {
            type: 'radar',
            data: {
                labels: ['è¯†ç¥', 'é‡‘èº«', 'ç¢ç‰', 'æœºç¼˜', 'å®ˆé™'],
                datasets: [{
                    data: [stats.study, stats.sport, stats.craft, stats.luck, stats.persistence],
                    backgroundColor: 'rgba(230, 180, 34, 0.2)', borderColor: '#e6b422', borderWidth: 1
                }]
            },
            options: { 
                scales: { r: { min: 0, max: 10, ticks: { display: false } } }, 
                plugins: { legend: { display: false } },
                maintainAspectRatio: false
            }
        });
    }

    function updateChart() {
        myChart.data.datasets[0].data = [stats.study, stats.sport, stats.craft, stats.luck, stats.persistence];
        myChart.update();
    }

    function exportData() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(stats));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "cultivation_data.json");
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }

    function importData() {
        const input = document.createElement('input');
        input.type = 'file';
        input.onchange = e => {
            const reader = new FileReader();
            reader.readAsText(e.target.files[0],'UTF-8');
            reader.onload = re => {
                stats = JSON.parse(re.target.result);
                save(); render();
                alert("å› æœå·²åŒæ­¥ã€‚");
            }
        }
        input.click();
    }

    initChart(); render(); updateCountdown();
</script>
</body>
</html>